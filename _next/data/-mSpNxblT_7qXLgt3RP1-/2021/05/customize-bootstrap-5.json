{"pageProps":{"post":{"title":"Bootstrap 5 をカスタマイズして使う","date":"2021-05-03","tags":["css"],"year":"2021","month":"05","slug":"customize-bootstrap-5","content":"<h2>はじめに</h2>\n<p>そろそろ Bootstrap 5 の安定版のリリースが来そうなので (2021.05.02 現在)、webpack 5 と組み合わせて、良い感じに最適化をしつつ、カスタマイズしていく方法を書いていく。</p>\n<h2>環境</h2>\n<ul>\n<li>Bootstrap 5 Beta 3</li>\n<li>Node.js 12.22.x</li>\n<li>Yarn 1.22.x</li>\n<li>webpack 5.36.x</li>\n</ul>\n<h2>ディレクトリ構成</h2>\n<p>この記事では webpack を使っているので以下のようなディレクトリ構成になっているが、注目すべき箇所は src/styles のみで、他はほぼほぼ無視していい。</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">├── dist\n├── node_modules\n├── package.json\n├── src\n│   ├── entries\n│   │   └── app.js\n│   ├── icons\n│   │   ├── github.html\n│   │   └── grip-horizontal.html\n│   ├── layouts\n│   │   ├── footer.html\n│   │   ├── head.html\n│   │   └── header.html\n│   ├── pages\n│   │   ├── 404.html\n│   │   ├── about.html\n│   │   └── index.html\n│   └── styles\n│       ├── _bootstrap.scss\n│       ├── _utilities.scss\n│       ├── _variables.scss\n│       └── app.scss\n├── webpack.common.js\n├── webpack.dev.js\n├── webpack.prod.js\n└── ...</code></pre></div>\n<h2>準備</h2>\n<p>webpack といくつかのプラグインを Yarn でインストールする。GitHub に <a href=\"https://github.com/jamband/sunraz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">デモリポジトリ</a> を用意しているので、package.json の中身等を参考にしてほしい。</p>\n<p>次に Bootstrap 5 をインストールする:</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">yarn add bootstrap@next</code></pre></div>\n<p>安定版がリリースされたら @next は必要なくなるので注意。</p>\n<h2>スタイルのカスタマイズ</h2>\n<p>大きく分けて 3 つファイルを用意しておく。</p>\n<ul>\n<li>_bootstrap.scss (Bootstrap に関連するファイルを import して構成していく)</li>\n<li>_utilities.scss (独自のカスタムな Utilities はここに書く)</li>\n<li>_variables.scss (独自のカスタムな変数はここに書く)</li>\n</ul>\n<h2>_bootstrap.scss</h2>\n<p><a href=\"https://github.com/twbs/bootstrap/blob/main/scss/bootstrap.scss\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">bootstrap.scss</a> をコピペして、パスを修正する。webpack (sass-loader) を使用している場合、3 つのパスの指定方法がある。</p>\n<ul>\n<li>@import \"~bootstrap/scss/...\";</li>\n<li>@import \"bootstrap/scss/...\";</li>\n<li>@import \"../../node_modules/bootstrap/scss/...\";</li>\n</ul>\n<p>上記の指定方法は基本的にすべて動作するが、最初に相対パスとしてファイルを探しつつ、なければ node_modules 内を探していくという感じなので、相対パスで書く方法が一番コンパイル時間が短くなる。</p>\n<p>ちなみに <a href=\"https://github.com/webpack-contrib/sass-loader/releases/tag/v11.0.0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@import \"~bootstrap/...\"; という書き方は sass-loader 11.x 以降非推奨</a> になった。</p>\n<p>デモリポジトリの _bootstrap.scss:</p>\n<div class=\"remark-highlight\"><pre data-file=\"src/styles/_bootstrap.scss\" class=\"language-scss\"><code class=\"language-scss\"><span class=\"token comment\">// Configuration</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/functions\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"./variables\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Custom variables</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/variables\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/mixins\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/utilities\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"./utilities\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Custom utilities</span>\n\n<span class=\"token comment\">// Layout &#x26; components</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/root\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/reboot\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/type\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/images\";</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/containers\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/grid\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/tables\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/forms\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/buttons\";</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/transitions\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/dropdown\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/button-group\";</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/nav\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/navbar\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/card\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/accordion\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/breadcrumb\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/pagination\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/badge\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/alert\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/progress\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/list-group\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/close\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/toasts\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/modal\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/tooltip\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/popover\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/carousel\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/spinners\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/offcanvas\";</span>\n\n<span class=\"token comment\">// Helpers</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/clearfix\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/colored-links\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/ratio\";</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/helpers/position\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/visually-hidden\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/stretched-link\";</span>\n<span class=\"token comment\">// @import \"../../node_modules/bootstrap/scss/helpers/text-truncation\";</span>\n\n<span class=\"token comment\">// Utilities</span>\n<span class=\"token keyword\">@import</span> <span class=\"token string\">\"../../node_modules/bootstrap/scss/utilities/api\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>独自のカスタム変数と Utilities は上記の箇所に差し込む。また、使わないものはコメントアウトしておくことで、よりコンパイル時間が短くなり、ファイルサイズの削減にもなる。</p>\n<h2>_utilities.scss</h2>\n<p>Bootstrap も 5 系から Utilities の追加、修正、削除などをできるようになった。それらを _utilities.scss に書く。詳しくは <a href=\"https://getbootstrap.com/docs/5.0/utilities/api/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Utility API</a> 。</p>\n<p>個人的にはあまり触りたくない箇所ではある。というのも、独自の Utility を追加したりすると、エディターでの補完が効かなかったり、デフォルトのスタイルとの違いが出てきて自分以外の人を混乱させる恐れがある。ここでの魔改造をやるならば Bootstrap 5 は捨てて TailwindCSS などを使ったほうが賢明だろう。やるにしても最小限に抑えておきたい。</p>\n<h2>_variables.scss</h2>\n<p>独自変数はこのファイルに書く。<a href=\"https://github.com/twbs/bootstrap/blob/main/scss/_variables.scss\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">bootstrap/_variables.scss</a> を参考にして、プロジェクトに合った色付けをしていく。実際、変数があり過ぎてめんどくさいのだが、着せ替えのできる唯一の場所でもあるので楽しんでやっていきたい。</p>\n<h2>本番環境に向けて</h2>\n<p>HTML を構成しているファイル内で使用していないスタイル等がある場合に、本番環境ではそれらを削除する <a href=\"https://purgecss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PurgeCSS</a> というツールがあるので導入しておく。</p>\n<p>フレームワーク等によってインストールするパッケージや設定方法が変わるのだが、デモリポジトリでは以下のような設定になっている:</p>\n<div class=\"remark-highlight\"><pre data-file=\"postcss.config.js\" class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> purgecss <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@fullhuman/postcss-purgecss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">context</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"autoprefixer\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"production\"</span> <span class=\"token operator\">&#x26;&#x26;</span>\n      <span class=\"token function\">purgecss</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/alert.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/button.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/carousel.js\",</span>\n          <span class=\"token string\">\"./node_modules/bootstrap/js/dist/collapse.js\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/dropdown.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/modal.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/offcanvas.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/popover.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/scrollspy.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/tab.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/toast.js\",</span>\n          <span class=\"token comment\">// \"./node_modules/bootstrap/js/dist/tooltip.js\",</span>\n          <span class=\"token string\">\"./src/**/*.html\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>詳しくは <a href=\"https://purgecss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PurgeCSS</a> や <a href=\"https://github.com/jamband/sunraz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">デモリポジトリ</a> などを参考にしてほしい。</p>\n<p>また簡易的なものだが、JavaScript 部分でも以下のように (webpack の場合)、使用するものだけ import することで、アセット周りのファイルサイズの削減にもなるのでやっておきたい:</p>\n<div class=\"remark-highlight\"><pre data-file=\"src/entries/app.js\" class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// js</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/alert.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/button.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/carousel.js\");</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bootstrap/js/dist/collapse.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/dropdown.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/modal.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/offcanvas.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/popover.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/scrollspy.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/tab.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/toast.js\");</span>\n<span class=\"token comment\">// require(\"bootstrap/js/dist/tooltip.js\");</span>\n\n<span class=\"token comment\">// css</span>\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../styles/app.scss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// images</span>\n</code></pre></div>\n<h2>本番環境へのビルドとデプロイ</h2>\n<p>最近のプラットホームは、それらを使うだけでいろいろな最適化を裏で勝ってにやってくれるので本当にありがたいわけだが、今回は <a href=\"https://pages.cloudflare.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cloudflare Pages</a> を使ってみた。Cloudflare Pages 自体は基本的に JAMstack を想定している感じだが、webpack でビルドしてデプロイするただの静的サイトでも使えるし、日本からアクセスする場合にも Netlify よりレスポンスが速いし (無料枠で比較した場合)、設定等も楽だったので、わりと感触は良かった。</p>\n<h2>まとめ</h2>\n<p>JavaScript のフレームワーク (React, Vue, Angular 等) が出てきた辺りから、それらのフレームワーク専用の UI Framework が増えて、あえて今、生の Bootstrap を使う必要性もなくなってきたわけだが、どのようなプロジェクトでも使えて、比較的剥がしやすいという意味でも <a href=\"https://bulma.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Bulma</a> や <a href=\"https://tailwindcss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TailwindCSS</a>、そして <a href=\"https://getbootstrap.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Bootstrap</a> などの CSS Framework を 1 つくらい覚えておいても損はないのかなぁと一周回って最近思うようになってきている。</p>\n<h2>リンク</h2>\n<p>この記事を作成するにあたり、デモ用のリポジトリとサイトを作ったので、興味のある人は参考にしてほしい。</p>\n<ul>\n<li><a href=\"https://github.com/jamband/sunraz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub: jamband/sunraz</a></li>\n<li><a href=\"https://sunraz.pages.dev/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SunRaz</a></li>\n</ul>\n"}},"__N_SSG":true}