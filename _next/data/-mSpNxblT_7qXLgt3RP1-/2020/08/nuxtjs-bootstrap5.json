{"pageProps":{"post":{"title":"Nuxt.js と Bootstrap 5","date":"2020-08-03","tags":["nuxt","css"],"year":"2020","month":"08","slug":"nuxtjs-bootstrap5","content":"<h2>はじめに</h2>\n<p>Bootstrap 5 もそろそろ安定版がリリースされそうな雰囲気なので (2020.08.03 現在の最新は 5.0.0-alpha1) 、最近よく触っている Nuxt.js と組み合わせて使ってみた感想を書いていく。</p>\n<h2>環境</h2>\n<ul>\n<li>Nuxt.js 2.14.x</li>\n<li>Bootstrap 5.0.0-alpha1</li>\n<li>nuxt-purgecss 1.0.x</li>\n</ul>\n<h2>試してみたかったこと</h2>\n<p>Bootstrap も 5.x 系から jQuery への依存をやめたり (オプションでまだ使えるようにはなっている) 、IE のサポートを切ったり (IE のサポートが必要な場合は 4.x を使う) 、といろいろ気になるところはあるが、自分が個人的に気になっていたところは、<a href=\"https://bootstrap-vue.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BootstrapVue</a> を使用せずに使えるかどうかと、<a href=\"https://vue-loader.vuejs.org/guide/css-modules.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CSS Modules</a> と組み合わせて使っても、良い感じに <a href=\"https://purgecss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PurgeCSS</a> が効くかどうかという点だ。</p>\n<p><a href=\"https://react-bootstrap.github.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">React Bootstrap</a> や <a href=\"https://bootstrap-vue.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">BootstrapVue</a> などは Bootstrap の JavaScript 部分を独自に実装していて、かつアクセシビリティの考慮もされているので非常に便利だが、それとは引き換えに残念ながら PurgeCSS とは非常に相性が悪いように思う。カスタムな Sass 構成にして、使用する CSS コンポーネントなどのみをインポートして使うようにしても、なかなか効果的なファイルサイズの削減とはいかない。</p>\n<p>といった感じで、Bootstrap 4.x では React Bootstrap や BootstrapVue と PurgeCSS の組み合わせは諦めていたが、5.x からは jQuery への依存もないので、モジュールをインポートして、コンポーネントの props に値を入れていく代わりに、ほぼほぼ生の形で HTML タグの class/className 属性にそのままぽいぽいと用意されたクラスを適用していけばいいので、これ PurgeCSS とも相性がよくなるよね？と期待したわけだ。</p>\n<p>また、ほぼほぼ生の形で HTML  タグが構成されるので CSS Modules の使用も簡単になり、これはぜひ試してみようと思い、Nuxt.js と Bootstrap 5 の組み合わせで簡単な Examples サイトを作ることになった。</p>\n<h2>試してみてわかったこと</h2>\n<p>Vue.js や Nuxt.js において今までコンポーネントへのスタイリングは <a href=\"https://vue-loader.vuejs.org/guide/scoped-css.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Scoped CSS</a> を使っていたが、今回はこれまた PurgeCSS との相性が悪い CSS Modules をあえて使って、どうにかこうにか Bootstrap 5 も絡めて、いい感じに PurgeCSS が効くか試してみたかった。</p>\n<p>Nuxt.js における CSS Modules は Vue.js と同様に <a href=\"https://vue-loader.vuejs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">vue-loader</a> がいろいろやってくれるわけだが、コードとしては以下のように記述する:</p>\n<div class=\"remark-highlight\"><pre data-file=\"pages/index.vue\" class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&#x3C;</span>template<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span>p <span class=\"token operator\">:</span><span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"$style.red\"</span><span class=\"token operator\">></span>\n    <span class=\"token maybe-class-name\">This</span> should be red\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&#x3C;</span>style module<span class=\"token operator\">></span>\n<span class=\"token punctuation\">.</span><span class=\"token property-access\">red</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n</code></pre></div>\n<p>生成される HTML は以下のようになる:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- スタイル部分 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>style</span> <span class=\"token attr-name\">data-vue-ssr-id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xxx<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n<span class=\"token comment\">/* something... */</span>\n<span class=\"token selector\"><span class=\"token class\">.red_3LoVX</span></span> <span class=\"token punctuation\">{</span> <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token color\">red</span> <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&#x3C;!-- body タグ内 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red_3LoVX<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  This should be red\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Scoped CSS とは違い、クラス名の suffix にハッシュ値が自動で付与されるので、クラス名の衝突を防ぐことができ、長ったらしいクラス名にしなくてもいい、という利点がある。</p>\n<p>ただ、ここで問題になったのは PurgeCSS との組み合わせである。Nuxt.js において PurgeCSS を使う場合、公式では <a href=\"https://github.com/Developmint/nuxt-purgecss\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">nuxt-purgecss</a> を利用できるよと書いてあったので使ってみたわけだが、CSS Modules には対応しておらず、そのままだと定義されたスタイルがデッドコードであってもなくても purge されてしまうので、何かしらの対処が必要になった。</p>\n<p><a href=\"https://github.com/Developmint/nuxt-purgecss/blob/master/lib/utils.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">nuxt-purgecss のデフォルトの設定</a> を見てみると、extractors 箇所で Vue のインラインスタイル部分の削除が行われ、結果して CSS Modules と噛み合わなくなるので、この部分を上書きして無効にし、purge されるのを防ぐことにした。</p>\n<p>設定ファイル:</p>\n<div class=\"remark-highlight\"><pre data-file=\"nuxt.config.js\" class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">purgeCSS</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function-variable function\">extractors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>結果として .vue ファイルのスタイル部分にデッドコードが存在しても purge されないわけだが、Bootstrap 5 を使う場合、用意されている変数をカスタマイズしていき、用意されているクラスを適用していって、不足分は Utility API で追加していってという感じで、実際 Scoped CSS/CSS Modules を使う箇所というのはかなり限られてくるので、そこはきっちり監視しなくてもいいや、という感じにした。</p>\n<p>Bootstrap 5 のコンポーネントにおける JavaScript モジュールの読み込みに関しては特にこれといった問題はなかった。mounted() なりでモジュールを require すればいい。</p>\n<p>その他の細かな部分はリポジトリを公開しているので興味のある人は見てほしい。</p>\n<h2>完成したもの</h2>\n<ul>\n<li><a href=\"https://quietz.netlify.app/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Quietz</a></li>\n<li><a href=\"https://github.com/jamband/quietz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Quietz のリポジトリ</a></li>\n</ul>\n<h2>まとめ</h2>\n<p>PurgeCSS との相性を考えると <a href=\"https://tailwindcss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TailwindCSS</a>  がやっぱり良いなぁとは思うけど、Bootstrap も Utilities がけっこう充実してきて、ある程度細かなスタイリングもできるようになったし、Dropdown や Modal  などはモジュールを読み込んであーだこーだするとすぐ使えるし、相変わらず CSS/UI Framework は便利だけど、いろいろ悩ましいなぁと思う。</p>\n<h2>関連リンク</h2>\n<ul>\n<li><a href=\"https://nuxtjs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nuxt.js</a></li>\n<li><a href=\"https://getbootstrap.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Bootstrap</a></li>\n<li><a href=\"https://purgecss.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PurgeCSS</a></li>\n<li><a href=\"https://quietz.netlify.app/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Quietz</a></li>\n</ul>\n"}},"__N_SSG":true}